<!DOCTYPE html>
<html>
    <canvas width = 400, height=400 style="width:400; height:400" id="drill"></canvas>
    <script>
        const canvas = document.getElementById("drill")
        const ctx = canvas.getContext('2d');

        let t=0 
        
        let x = 200
        let y = 100
        let a = 0

        requestAnimationFrame(gameLoop);

        function gameLoop(now) {
            const cosa = Math.cos(a)
            const sina = Math.sin(a)

            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.setTransform(cosa, -sina, sina, cosa, x, y)

            const h = 100
            const w = 100
            const th = 7 // thickness
            const e = 5
            const b = 1 * Math.PI/7
            const num = 4


            const w0 = w*(2*t % 1)

            ctx.beginPath()
            ctx.moveTo(-w/2, 0)
            ctx.lineTo(w/2-w0, 0)
            if(w0 < w/2){
                ctx.lineTo(w/2-w0, (2 * w0 * h) / w)
                ctx.lineTo(0, h)
            } else {
                ctx.lineTo(w/2-w0, 2* h - ((2 * w0 * h) / w))
            }
            if(2*t % 2 < 1) {ctx.fillStyle = "black"} else ctx.fillStyle = "gray"
            
            ctx.fill()

            ctx.beginPath()
            ctx.moveTo(w/2, 0)
            ctx.lineTo(w/2-w0, 0)
            if(w0 > w/2){
                ctx.lineTo(w/2-w0, 2* h - ((2 * w0 * h) / w))
                ctx.lineTo(0, h)
            } else {
                ctx.lineTo(w/2-w0, ((2 * w0 * h) / w))
            }
            if(2*t % 2 > 1) {ctx.fillStyle = "black"} else ctx.fillStyle = "gray"
            ctx.fill()


            const cosb = Math.cos(b)
            const sinb = Math.sin(b)
            
            const l0 = (sinb*w)/(2*cosb)

            const offsets = []
            for(let n = 0; n<num;n++) offsets.push(n/num)

            offsets.forEach(t0 => {
                console.log
                const l = h-((t + t0)% 1)*(h+l0)
                if(l > l0) {
                    x1 = (h-l)/((2*h/w)*cosb + sinb)
                    x2 = (h-l)/((2*h/w)*cosb - sinb)
                } else {
                    x1 = (h-l)/((2*h/w)*cosb + sinb)
                    x2 = l/sinb
                }

                ctx.setTransform(cosa, -sina, sina, cosa, x, y)
                ctx.transform(cosb, -sinb, sinb, cosb, 0, l)

                ctx.beginPath()
                ctx.roundRect(-x1-e, -th, x1+x2+2*e, 2*th, 5)
                ctx.fillStyle = "lightgray"
                ctx.fill()
            })

            ctx.setTransform(1, 0, 0, 1, 0, 0)

            requestAnimationFrame(gameLoop);
            t+=0.005
            
        }

    </script>
</html>